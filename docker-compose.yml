services:
  udemy-downloader:
    image: udemy-downloader:latest
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./output:/app/out_dir:rw
      - ./keyfile.json:/app/keyfile.json:ro
      - ./cookie.txt:/app/cookie.txt:ro
    env_file:
      - .env
    command: sleep infinity

  udemy-web:
    image: udemy-downloader:latest
    depends_on:
      - udemy-downloader
    ports:
      - "9123:9123"
    volumes:
      - ./output:/app/out_dir:rw
      - ./keyfile.json:/app/keyfile.json:ro
      - ./cookie.txt:/app/cookie.txt:ro
      - ./web_data:/app/web_data:rw
    env_file:
      - .env
    command: uvicorn webapp.server:app --host 0.0.0.0 --port 9123